import{r as d,j as e,R as j,b as S,s as B,c as y,m as p,d as g,t as I,h as k,e as L,f as Q,g as R}from"./index-w7fz5q-u.js";import{p as T,D as V,S as O,A as F,a as G}from"./ArticleContent-7cZEJRd_.js";import{S as Z,E as D,a as U,C as W,w as A}from"./promiseWrapper-8OwR5HJH.js";import{B as b}from"./Button-KZ3Jhckk.js";import{A as N}from"./Avatar-hQQOi_6T.js";import{u as C}from"./useIsAuthenticated-5Kxe10Mt.js";import{S as H,n as P}from"./like-filled-G_ZCkRLM.js";import{H as K}from"./Helmet-w-K0CMMP.js";import"./index-JOx5ynQw.js";const Y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAIAAABt+uBvAAAAA3NCSVQICAjb4U/gAAAFG0lEQVR4nO2aT08bRxTA35vddby0tTFVXKVSOQQR0m/QT5Iri9Q2FKlFpKiqkMgFiUrBAVEk/rUS5pqvE0VgI3KgSgNExfZWeB3v7rwejFK1GB6sx2OQ5nfwxdo3b387OztvZnB86yswXIzodQI3HSOIwQhiMIIYjCAGI4jBCGIwghiMIAYjiMEIYjCCGIwgBiOIwQhiMIIYjCAGI4jBCGIwghiMIAYjiMHudQKw5G1UIKydNAI/kjEBgLDQzdjZgXQOnKni496mh73aFyOiubHVg30fCYWFKBAQEFt/ARCQJBkTIQ0OZWa3JrD1n3Z6I6jgrZf2K4hC2MyNE4GMiEiODOWmi+O6EvyXHoxBM6PLu+Wq5ViWw3cLRLActBxrt1ydGV3WkuB/0C1o+tHiu9eB44prvTGI4Lji3etg+tFi11Jrj1ZBM6PLtbdNO5WwUTslam+bmvuRPkEFb/14L0hsp4WdEsd7QcFbV5UViyZBRFTar9hpBc3ZaVHarxBR56GugiZBc2OriNcbdy4CERDF3NiqglhXQJOgg31f2MomMsLGg31fVTSmLQ1tLHkbSConeoiAhEvehrKIF6NDUAVCYSmeBwsLKxCqjdm+IQ1t1E4aKBQLQoG1k4bamG3RISjwI1BeSCEEfqQ6aBt0CJIRKa80EaFV+ncbLV+xLtXhWmZCOgQJC5VP64hA4bzhEnQIcjO2+qdN4GZ0rPbpEJQdSJNUbIgkZQfSamO2RYegHDjKB1QZUw4ctTHbokPQVPExocrqkggISc9ytaZabHAoIyNlhmREg0MZVdEuR5Og2a0JIqmkExEBkZzdmlAQ6wpoEoSII0O5qCE7DxU15MhQTtsmh74VxenieH7YjZodOYqaMj/s6tze0LomPb89mb2XSuwoasrsvdT89qTarC5H965G4cWTu/fdMLjeeEQEYSDv3ncLL550LbX29GBfbH578uGD/jiM45D/9hNBHFIcxg8f9GvuOy3M1jNDzwR9wBxeuN2Y80EMRhCDEcRgBDEYQQxGEIMRxNCbU67PvMU0ZE8hrEMY1KPG32HYIBmdLVwjgLCFk8b0J47bZ/eB8xE4Daj9VNRdiIG2iSIR/Tr2mw9RxQ/84yYAIgIiIsLZrnTr50OpAWfbXiSJCIhaVRtl8qlcxs2A/cPWN3qKj+4K+sVbAPj4uFb3j5tCIAoUArGD15okSEkkSUrK5FP5bB/C6c/FaXUp/5+uCIojWfh6849jv1GVwm7VosobAZIgY5IRpfvFF/nM9O/fWrb6ZhQLeu6t/AXyaK9uWaJLXs7TMhXH8rPhvk9B/Fj8XmFwZYKWvJU/G9HJQcN2hJ5N4fPIiKJQDgymP0/bU4o0qXnET72VV+VT/zBMuVav7ACAsDHlWv5h+Kp8+tRbURKz0x607K3tHPgyAsvpmZe2xCEJG74czEwWv+skTkc9aMFbe1muAeFNswMAloNA+LJcW/DWOomTXNAzb223VHVcoWckTgAKcFyxW6o+68BRwptb8TZL5Wqqz0rcsDZSfVapXF3xNpNdnlDQzpuqc+cW2Gnh3LF23lSTXZtEUMHbCAN5Y9+s86CAMJCFROeqk9zlYb1uObdHDwAAWI44rNcTXJjkPv2j9906l9k9EPyj9wmuSyJIxuqP9XabxMeGE70pt83OGYnSvmVDiX6MIAYjiMEIYjCCGIwgBiOIwQhiMIIYjCAGI4jBCGIwghiMIAYjiMEIYjCCGIwghn8AO43uyjW7PsoAAAAASUVORK5CYII=",$=({className:r,content:t,handleType:a,onSelect:o,onClick:n,disabled:l,placeholder:i="Write a comment..."})=>{const c=d.useRef(null),s=d.useRef(null);return d.useEffect(()=>{c.current.value=s.current.value,c.current.style.height="auto",s.current.style.height=c.current.scrollHeight+"px"},[t]),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx("textarea",{ref:c,className:"invisible w-full overflow-y-hidden",rows:1}),e.jsx("textarea",{ref:s,value:t,onChange:a,maxLength:700,rows:1,onClick:n,className:`${r} w-full relative bottom-4 overflow-y-hidden`,onSelect:o,disabled:l,placeholder:i})]})};function J(){return e.jsxs("svg",{width:"45px",height:"45px",viewBox:"0 0 128 128","data-name":"Layer 1",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("defs",{children:e.jsx("style",{dangerouslySetInnerHTML:{__html:".cls-1{fill:#a7aece;}.cls-2{fill:#ffffff;opacity:0.3;}.cls-3{fill:#7f3838;}.cls-4{fill:#bc5b57;}.cls-5{fill:#ffd8c9;}.cls-10,.cls-6,.cls-9{fill:none;stroke-linecap:round;}.cls-10,.cls-6{stroke:#393c54;stroke-linejoin:round;}.cls-6{stroke-width:3px;}.cls-7{fill:#393c54;}.cls-8{fill:#515570;}.cls-9{stroke:#ffffff;stroke-miterlimit:10;stroke-width:2px;opacity:0.1;}.cls-10{stroke-width:6px;}"}})}),e.jsx("title",{}),e.jsx("circle",{className:"cls-1",cx:"64",cy:"64",r:"60"}),e.jsx("circle",{className:"cls-2",cx:"64",cy:"64",r:"48"}),e.jsx("path",{className:"cls-3",d:"M40,22A10,10,0,0,0,30,32v81.43a59.62,59.62,0,0,0,20,8.91V32A10,10,0,0,0,40,22Z"}),e.jsx("path",{className:"cls-4",d:"M107.85,85.85c0-14.49-9.1-25-21.9-28.94l2-3.31a.59.59,0,0,0-.58-.9l-6,.82a.59.59,0,0,1-.54-1l2.66-3.2a.59.59,0,0,0-.54-1,100,100,0,0,0-21.07,5.4A35,35,0,0,0,40.15,85.85v3.22c0,15.48-1.65,21.18-6.36,26.76h0a59.94,59.94,0,0,0,72-8.77l0-.16A94.24,94.24,0,0,0,107.85,85.85Z"}),e.jsx("path",{className:"cls-5",d:"M88.74,93.46a6.31,6.31,0,0,1-5-7.63,6.55,6.55,0,0,1,7.58-4.72l5.91,1A.8.8,0,0,0,98,81c-3.89-7-13.76-12.64-24-12.64S53.88,74,50,81a.8.8,0,0,0,.83,1.18l5.91-1a6.55,6.55,0,0,1,7.58,4.72,6.31,6.31,0,0,1-5.05,7.63L51.09,94.9a.8.8,0,0,0-.53,1.23c3.23,5,10.2,8.42,23.44,8.42s20.21-3.38,23.44-8.42a.8.8,0,0,0-.53-1.23Z"}),e.jsx("path",{className:"cls-6",d:"M81.89,92.19a9,9,0,0,1-2.77,2.21,11.61,11.61,0,0,1-10.24,0"}),e.jsx("path",{className:"cls-7",d:"M79.12,86.62c0,2.83-2.29,4.25-5.12,4.25s-5.12-1.42-5.12-4.25C68.88,85,79.12,84.75,79.12,86.62Z"}),e.jsx("path",{className:"cls-7",d:"M57.33,87.48l3.05-.73a.71.71,0,0,1,.89.68,4,4,0,0,1-4.28,4,3.9,3.9,0,0,1-3-1.84,3.94,3.94,0,0,1,5.53-5.37.73.73,0,0,1,.08,1.11Z"}),e.jsx("path",{className:"cls-7",d:"M90.4,87.48l3-.73a.72.72,0,0,1,.89.68,4,4,0,0,1-4.29,4,3.88,3.88,0,0,1-3-1.84,3.94,3.94,0,0,1,5.52-5.37.72.72,0,0,1,.09,1.11Z"}),e.jsx("path",{className:"cls-7",d:"M92,29H15.28A59.76,59.76,0,0,0,7.09,45H92a8,8,0,0,0,0-16Z"}),e.jsx("circle",{className:"cls-8",cx:"92",cy:"37",r:"8"}),e.jsx("circle",{className:"cls-9",cx:"92",cy:"37",r:"4.31"}),e.jsx("line",{className:"cls-10",x1:"13",x2:"20.5",y1:"42",y2:"49.5"}),e.jsx("line",{className:"cls-10",x1:"66",x2:"74.38",y1:"32.1",y2:"23.72"})]})}const v=j.memo(({postId:r,replyingTo:t,handleCancelClicked:a,refreshComments:o,className:n})=>{const l=S(B),i=C(),c=y(),[s,f]=d.useState(""),u=m=>{i===!1?c(p()):f(m.currentTarget.value)},h=()=>{if(i===!1){c(p());return}fetch(`${g}/api/blog/post/${r}/comment`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:s,parent_comment_id:t})}).then(m=>{m.ok?(o(),f("")):I(m)}).catch(m=>{k(m),alert("Failed to upload the comment..")}).finally(()=>a&&a())};return e.jsxs("div",{className:`rounded-lg flex flex-col w-full
                px-4 py-3 bg-default-4 dark:bg-body  ${n}`,children:[e.jsxs("div",{className:"flex w-full gap-3",children:[e.jsx(N,{avatar:i&&l.avatar?l.avatar:void 0,size:45,children:e.jsx(J,{})}),e.jsx($,{content:s,handleType:u,className:`focus:outline-none resize-none\r
                        border-b-[1px] border-slate-500 rounded-none\r
                        bg-transparent`})]}),e.jsxs("div",{className:"flex items-center justify-end w-full gap-3 text-sm flex-wrap",children:[e.jsx(b,{onClick:h,className:"text-orange-400 dark:text-orange-400 font-bold dark:font-normal text-sm",children:"Upload"}),t&&e.jsx(b,{onClick:()=>{f(""),a!==void 0&&a()},children:"Cancel"})]})]})}),X=r=>(r.forEach(t=>t.UploadedAt=new Date(Date.parse(t.UploadedAt.toString()))),r),q=r=>{r.sort((n,l)=>n.UploadedAt.getTime()-l.UploadedAt.getTime());const t=new Map;for(const n of r){const l=n.ParentCommentId||"";t.has(l)||t.set(l,[]),t.get(l).push(n)}const a=[],o=(n,l)=>{const i=t.get(n)||[];for(const c of i)c.depth=l,a.push(c),o(c.Id,l+1)};return o("",0),a},z=r=>{const a=new Date().getTime()-r.getTime(),o=60*1e3,n=o*60,l=n*24,i=l*30,c=l*365;if(a<o){let s=Math.floor(a/1e3);return s=s<0?0:s,`${s} ${s===1?"second":"seconds"} ago`}else if(a<n){let s=Math.floor(a/o);return s=s<0?0:s,`${s} ${s===1?"minute":"minutes"} ago`}else if(a<l){let s=Math.floor(a/n);return s=s<0?0:s,`${s} ${s===1?"hour":"hours"} ago`}else if(a<i){let s=Math.floor(a/l);return s=s<0?0:s,`${s} ${s===1?"day":"days"} ago`}else if(a<c){let s=Math.floor(a/i);return s=s<0?0:s,`${s} ${s===1?"month":"months"} ago`}else{let s=Math.floor(a/c);return s=s<0?0:s,`${s} ${s===1?"year":"years"} ago`}};function w({children:r,onClick:t,className:a}){return e.jsx("button",{type:"button",className:`flex flex-row rounded justify-between items-center w-fit cursor-pointer
            border-2 py-[3px] px-2 text-xs gap-2 text-default-17-dark dark:text-default-15
            bg-default-1 dark:bg-default-3-dark border-default-6 dark:border-default-8-dark ${a}`,onClick:t,children:r})}const _=j.memo(({postId:r,comment:t,refreshComments:a})=>{const o=y(),n=C(),l=d.useRef(T(V.sanitize(t.Content))),[i,c]=d.useState(t.HasLiked),[s,f]=d.useState(!1),u=d.useRef(!1),[h,m]=d.useState(t.LikeCnt),E=()=>{if(u.current!==!0){if(n===!1){o(p());return}u.current=!0,fetch(`${g}/api/blog/comment/${t.Id}/has-liked`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(!i)}).then(x=>{if(x.ok)return x.json();I(x)}).then(x=>{i==null&&L("has_liked is null or undefined"),c(x),m(h+(x?1:-1))}).catch(k).finally(()=>{u.current=!1})}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-row auto-cols-min rounded-lg",children:[t.ParentCommentId&&e.jsx("div",{className:"flex flex-row",children:Array.from({length:t.depth}).map((x,M)=>e.jsx("div",{className:"w-0 border-r-[1.8px] mr-[0.8rem] md:mr-4 lg:mr-6 border-default-8 dark:border-default-10-dark"},M))}),e.jsxs("div",{className:"py-4 w-full space-y-3",children:[e.jsxs("div",{className:"w-full flex flex-row flex-nowrap",children:[e.jsx(N,{avatar:t.Avatar?t.Avatar:Y,size:38}),e.jsxs("div",{className:"flex flex-col ml-2 justify-center text-sm md:text-base",children:[e.jsxs("div",{className:"flex flex-row flex-wrap items-center",children:[e.jsx("span",{className:`w-fit border rounded-2xl mr-1 px-[7px] text-[0.7rem] break-all
                                    text-center
                                    ${t.Email!=="jeheecheon@gmail.com"&&"hidden"} border-orange-400 text-orange-400`,children:"Site Owner"}),e.jsx("span",{className:"text-default-18-dark text-xs break-all",children:z(t.UploadedAt)})]}),e.jsx("p",{className:"dark:text-default-14 text-[0.8rem] break-all",children:t.Email})]})]}),e.jsx("div",{className:`min-h-[50px] py-2 px-3 rounded-lg text-sm md:text-base break-all\r
                        bg-default-4 dark:bg-body dark:text-default-14 w-full`,children:l.current}),e.jsxs("div",{className:"flex flex-row flex-wrap gap-3",children:[e.jsxs(w,{onClick:E,children:[i?e.jsx(H,{className:"fill-red-500"}):e.jsx(O,{className:"fill-gray-500 dark:fill-gray-500"}),e.jsx("span",{children:h})]}),e.jsxs(w,{onClick:()=>{if(n===!1){o(p());return}f(!s)},children:[e.jsx(Z,{className:`transition-colors duration-500 ${s?"fill-orange-500":"fill-gray-500 dark:fill-gray-500"}`}),e.jsx("span",{children:"Reply"})]})]})]})]}),e.jsx(v,{postId:r,replyingTo:t.Id,handleCancelClicked:()=>f(!1),refreshComments:a,className:`my-2 ${s?"opacity-100 block":"opacity-0 absolute left-0 w-fit invisible"} transition-opacity duration-1000`})]})}),ee=j.memo(({className:r,postId:t,commentsAwaiter:a,refreshComments:o})=>{const n=d.useMemo(()=>{const l=a.Await();return q(X(l.map(i=>i)))},[a]);return e.jsxs("div",{className:`max-w-[1024px] w-full flex flex-col mb-4
                ${r}`,children:[e.jsx("div",{className:"mb-2 border-b-2 pb-1 border-b-default-13 dark:border-b-default-18-dark",children:e.jsxs("p",{className:"pl-2 text-base md:text-xl text-orange-400 font-ligh",children:[n.length," Comments"]})}),e.jsx(v,{postId:t,refreshComments:o,className:"mt-2 mb-[60px]"}),n.map(l=>e.jsx(_,{comment:l,postId:t,refreshComments:o},l.Id))]})}),se=j.memo(({post:r,commentsAwaiter:t,refreshComments:a})=>e.jsxs(F,{children:[e.jsx(G,{post:r}),e.jsx("div",{className:"max-w-[1024px] w-full px-3",children:e.jsx(D,{fallback:e.jsx(U,{children:"Failed to load comments for this post..."}),children:e.jsx(d.Suspense,{fallback:e.jsx(Q,{textSize:"text-sm",children:"Loading Comments... 🐶"}),children:e.jsx(ee,{className:"",postId:r.Id,commentsAwaiter:t,refreshComments:a})})})})]})),me=()=>{const r=R(),t=d.useMemo(()=>`${g}/api/blog/post/${r.Id}/comments`,[r.Id]),[a,o]=d.useState(W());return d.useEffect(()=>{o(A(fetch(t,{credentials:"include"})))},[t]),e.jsxs(e.Fragment,{children:[e.jsx(se,{post:r,commentsAwaiter:a,refreshComments:()=>o(A(fetch(t,{credentials:"include"})))}),e.jsx(K,{children:e.jsxs("title",{children:[r.Title," | ",P]})})]})};export{me as default};
