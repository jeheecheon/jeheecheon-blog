import{d as E,b as B,r as n,E as i,t as c,F as y,G as U,h,j as e,H as _,e as C}from"./index-iAXRfFNB.js";import{B as p}from"./Button-P5VXAYnM.js";import{A as F,a as L}from"./ArticleContent-GZedMbXE.js";import"./like-filled-Nmv_lXlr.js";const J=()=>{const r=E(),I=B(t=>t.category.leafCategories),[b,$]=n.useState(),[S,w]=n.useState(""),[a,l]=n.useState(),[u,N]=n.useState(!1),[m,f]=n.useState(!1),[x,j]=n.useState(!1),[d,k]=n.useState(!1);n.useEffect(()=>(g(),r(i("https://jeheecheon.s3.ap-northeast-2.amazonaws.com/blog/defaults/images/cover.jpg")),()=>{r(i(""))}),[]);const g=()=>fetch("https://jeheecheon.azurewebsites.net/api/blog/posts/list",{headers:{Authorization:`Bearer ${sessionStorage.getItem("jwt")}`}}).then(t=>{if(t.ok)return t.json();c(t)}).then(t=>{t&&t.length>0&&(y(t),U(t),$(t))}).catch(t=>{h(t),alert("Error occured while fecthing a list of posts..")}),z=t=>{w(t),l({}),t!==""?fetch(`https://jeheecheon.azurewebsites.net/api/blog/post/${t}/with-metadata`,{headers:{Authorization:`Bearer ${sessionStorage.getItem("jwt")}`}}).then(s=>{if(s.ok)return s.json();c(s)}).then(s=>{s?(y(s),l(s),s.Cover!==void 0&&s.Cover!==null?r(i(s.Cover)):r(i("https://jeheecheon.s3.ap-northeast-2.amazonaws.com/blog/defaults/images/cover.jpg"))):C("Post is null or undefined")}).catch(s=>{h(s),alert("Failed to fetch the post info...")}):r(i("https://jeheecheon.s3.ap-northeast-2.amazonaws.com/blog/defaults/images/cover.jpg"))},T=()=>{confirm("You want to update the post, right?")&&fetch(`https://jeheecheon.azurewebsites.net/api/blog/post/update?set_edited_date_as_null=${x}&set_edited_date=${m}&set_uploaded_date=${d}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.getItem("jwt")}`},body:JSON.stringify(a)}).then(t=>{t.ok?(g(),f(!1),j(!1),k(!1)):c(t)}).catch(t=>{alert("Failed to update the current post"),h(t)})},P=()=>{confirm("Are you sure you wnat to delete this post?????!")&&fetch(`https://jeheecheon.azurewebsites.net/api/blog/post/${a==null?void 0:a.Id}`,{headers:{Authorization:`Bearer ${sessionStorage.getItem("jwt")}`},method:"DELETE"}).then(t=>{t.ok?(w(""),g(),l({})):c(t)}).catch(t=>{alert("Failed to delete the selected post"),h(t)})},D=()=>{fetch("https://jeheecheon.azurewebsites.net/api/blog/post/upload-empty",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.getItem("jwt")}`}}).then(t=>{t.ok?g():c(t)}).catch(t=>{alert("Failed to create an empty post"),h(t)})},A=t=>{if(t.currentTarget.files!==null&&t.currentTarget.files!==void 0){const s=t.currentTarget.files[0];if(s!=null){const v=new FormData;v.append("image",s),fetch(`https://jeheecheon.azurewebsites.net/api/blog/posts/${a==null?void 0:a.Id}/images/upload`,{headers:{Authorization:`Bearer ${sessionStorage.getItem("jwt")}`},method:"POST",body:v}).then(o=>{if(o.ok)return o.json();c(o)}).then(o=>{o&&a?(console.log(o),r(i(o)),l({...a,Cover:o})):C("Image URL is null or undefined")}).catch(o=>{alert("Failed to upload the selected image to s3"),h(o)})}}};return e.jsxs(e.Fragment,{children:[e.jsxs(_,{children:[e.jsx("title",{children:"Edit | jeheecheon"}),e.jsx("link",{rel:"canonical",href:"https://blog.jeheecheon.com"}),e.jsx("meta",{name:"description",content:"Blog post edit page"}),e.jsx("meta",{name:"keywords",content:"tech, blog, jeheecheon"}),e.jsx("meta",{name:"author",content:"jeheecheon"}),"/",e.jsx("meta",{property:"og:title",content:"Edit | jeheecheon"}),e.jsx("meta",{property:"og:description",content:"Blog post edit page"}),e.jsx("meta",{property:"og:image",content:"https://jeheecheon.s3.ap-northeast-2.amazonaws.com/blog/defaults/images/cover.jpg"}),e.jsx("meta",{property:"og:type",content:"website"}),e.jsx("meta",{property:"og:site_name",content:"jeheecheon"}),e.jsx("meta",{property:"og:locale",content:"ko_KR"}),e.jsx("meta",{property:"og:url",content:"https://blog.jeheecheon.com"}),e.jsx("meta",{name:"twitter:title",content:"Edit | jeheecheon"}),e.jsx("meta",{name:"twitter:card",content:"summary"}),e.jsx("meta",{name:"twitter:description",content:"Blog post edit page"}),e.jsx("meta",{name:"twitter:image",content:"https://jeheecheon.s3.ap-northeast-2.amazonaws.com/blog/defaults/images/cover.jpg"})]}),u&&a&&e.jsx(F,{children:e.jsx(L,{post:{...a,LikeCnt:1004}})}),e.jsxs("div",{className:`flex flex-col items-center mt-[30vh] text-default-15-dark dark:text-default-15 max-w-[768px] mx-auto
                ${u&&"hidden"}`,children:[e.jsx("p",{className:"text-2xl font-medium mt-2",children:"글 작성"}),e.jsxs("select",{id:"post-id-select",value:S,onChange:t=>z(t.currentTarget.value),className:`mt-2 text-default-18-dark dark:text-default-18 outline-none focus:outline-none w-full\r
                            bg-default-3 dark:bg-default-3-dark border-[1px] border-default-10 dark:border-default-6-dark`,children:[e.jsx("option",{value:"",children:"Select a post"}),b&&b.map(t=>e.jsx("option",{value:t.Id,children:`ID: ${t.Id} | Title: ${t.Title} | Date: ${t.UploadedAt.toLocaleString()}`},t.Id))]}),e.jsxs("div",{className:"flex my-2 gap-2 justify-end w-full",children:[(a==null?void 0:a.Id)&&e.jsxs("div",{children:[e.jsx("input",{id:"IdOfPostEditing",type:"text",value:a==null?void 0:a.Id,onChange:()=>{},className:"invisible absolute"}),e.jsx(p,{children:e.jsxs("label",{className:"flex items-center gap-3 text-default-16-dark dark:text-default-16 text-nowrap",children:["Change Cover",e.jsx("input",{type:"file",className:"border-2 hidden",onInput:A})]})})]}),e.jsx(p,{onClick:D,className:"text-default-16-dark dark:text-default-16 text-nowrap",children:"Create Post"})]}),(a==null?void 0:a.Id)&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"sticky top-0 z-[50] mt-2",children:e.jsxs("div",{className:"flex",children:[e.jsx("input",{value:a.Title,onChange:t=>l({...a,Title:t.currentTarget.value}),className:`w-full pl-2 text-default-10-dark py-2 focus:outline-none outline-none\r
                                        bg-white border-[1px] border-default-10 rounded-none`}),e.jsx("select",{className:`text-default-10-dark focus:outline-none outline-none\r
                                        bg-white border-[1px] border-default-10 rounded-none`,value:a.CategoryId?a.CategoryId:"",onChange:t=>l({...a,CategoryId:t.currentTarget.value}),children:I.map(t=>e.jsx("option",{value:t.Id,children:t.Id},t.Id))})]})})})]}),(a==null?void 0:a.Id)&&e.jsxs("div",{className:`flex flex-col w-full gap-3 pb-10 mx-auto px-1 mt-2
                    text-default-18-dark dark:text-default-18
                    max-w-[768px]`,children:[e.jsxs("label",{children:["Public: ",e.jsx("input",{type:"checkbox",checked:a.IsPublic,onChange:()=>l({...a,IsPublic:!a.IsPublic})})]}),e.jsxs("label",{children:["Reset uploaded date: ",e.jsx("input",{type:"checkbox",checked:d,onChange:()=>{d||j(!0),k(!d),f(!1)}})]}),e.jsxs("label",{children:["Update edited date: ",e.jsx("input",{type:"checkbox",checked:m,onChange:()=>{d||(m||j(!1),f(!m))}})]}),e.jsxs("label",{children:["Set edited date as null: ",e.jsx("input",{type:"checkbox",checked:x,onChange:()=>{d||(x||f(!1),j(!x))}})]}),e.jsxs("div",{className:"flex justify-center gap-3 flex-wrap mt-2",children:[e.jsx(p,{onClick:T,className:"text-sky-500 dark:text-sky-600 font-medium",children:"Update"}),e.jsx(p,{onClick:P,className:"text-red-500 dark:text-red-500 font-medium",children:"Delete"}),e.jsx(p,{onClick:()=>{N(!u)},className:"font-medium",children:u?"Edit":"Preview"})]})]})]})};export{J as default};
